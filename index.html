<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tesla Drive Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    overflow: hidden;
  }
  iframe, img { border: 0 }
  .card {
    background: #111;
    border: 1px solid #222;
    border-radius: 18px;
  }
  .dim { opacity: 0.6 }
</style>
</head>

<body class="p-4">

<!-- ===== HEADER STATUS BAR ===== -->
<header class="flex justify-between items-center mb-4">
  <div class="flex items-center gap-6">
    <div class="text-6xl font-bold" id="tempNow">--Â°</div>

    <div>
      <div class="flex items-center gap-2">
        <span class="text-3xl" id="weatherNow">â˜€</span>
        <span class="text-xl text-gray-400">â†’</span>
        <span class="text-2xl" id="weather4h">ðŸŒ§</span>
        <span class="text-sm text-gray-500 ml-1">4h</span>
      </div>
      <div class="text-xs text-gray-500" id="weatherDesc">Loading...</div>
    </div>
  </div>

  <div class="flex items-center gap-8 text-right">
    <div>
      <div class="text-xs text-gray-500">PM2.5</div>
      <div class="text-2xl font-bold text-yellow-400" id="aqiVal">--</div>
    </div>

    <div>
      <div class="text-xs text-gray-500">TIME</div>
      <div class="text-2xl font-bold" id="clock">--:--</div>
    </div>
  </div>
</header>

<!-- ===== MAIN SPLIT LAYOUT ===== -->
<main class="grid grid-cols-10 gap-4 h-[calc(100vh-120px)]">

  <!-- LEFT : RADAR -->
  <section class="col-span-3 card p-2 relative">
    <img id="radarImg"
      class="w-full h-full object-cover rounded-xl"
      alt="Rain Radar"/>
    <div class="absolute top-2 left-2 text-[10px] text-blue-400 bg-black/70 px-2 py-1 rounded">
      RAIN RADAR
    </div>
    <div id="radarStatus"
      class="absolute bottom-2 right-2 text-[10px] text-gray-400">
    </div>
  </section>

  <!-- RIGHT : INFO STACK -->
  <section class="col-span-7 grid grid-rows-3 gap-4">

    <!-- SUPERCHARGER -->
    <div class="card p-4">
      <div class="text-xs text-gray-500 mb-1">âš¡ Nearest Supercharger</div>
      <div class="text-3xl font-bold text-green-400" id="scName">--</div>
      <div class="text-sm text-gray-400" id="scMeta">--</div>
    </div>

    <!-- EMERGENCY -->
    <div class="card p-3 flex items-center gap-3 text-sm justify-between">
      <span>ðŸš‘ <a href="tel:1669">1669</a></span>
      <span>ðŸš“ <a href="tel:1193">1193</a></span>
      <span>ðŸš’ <a href="tel:199">199</a></span>
      <span>âš¡ <a href="tel:1800011199">Tesla</a></span>
    </div>

    <!-- SPEED CAMERA -->
    <div class="card p-4">
      <div class="text-xs text-gray-500 mb-1">ðŸ“· Speed Camera Zone</div>
      <div class="text-2xl font-bold text-red-400" id="camInfo">
        No camera nearby
      </div>
    </div>

  </section>
</main>

<!-- ===== FOOTER ===== -->
<footer class="mt-3 text-[10px] text-gray-600 text-center">
  Tesla Drive UI Â· Offline-safe Â· Bangkok fallback
</footer>

<script>
/* ===============================
   CONFIG
================================ */
const FALLBACK_LAT = 13.7563;
const FALLBACK_LON = 100.5018;
const OWM_KEY = "YOUR_OPENWEATHER_KEY";
const WAQI_TOKEN = "YOUR_WAQI_TOKEN";

/* ===============================
   CLOCK
================================ */
function updateClock(){
  const d = new Date();
  document.getElementById("clock").textContent =
    d.getHours().toString().padStart(2,'0') + ":" +
    d.getMinutes().toString().padStart(2,'0');
}
setInterval(updateClock,1000);
updateClock();

/* ===============================
   LOCATION (FAIL-SAFE)
================================ */
function getLocation(){
  return new Promise(res=>{
    if(!navigator.geolocation){
      res({lat:FALLBACK_LAT,lon:FALLBACK_LON, approx:true});
      return;
    }
    navigator.geolocation.getCurrentPosition(
      p=>res({lat:p.coords.latitude, lon:p.coords.longitude}),
      ()=>res({lat:FALLBACK_LAT,lon:FALLBACK_LON, approx:true}),
      {timeout:5000}
    );
  });
}

/* ===============================
   WEATHER + AQI
================================ */
async function loadWeather(lat,lon){
  try{
    const r = await fetch(
      `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${OWM_KEY}`
    );
    const d = await r.json();
    localStorage.setItem("weather",JSON.stringify(d));
    renderWeather(d);
  }catch{
    const cached = localStorage.getItem("weather");
    if(cached) renderWeather(JSON.parse(cached));
  }
}

function renderWeather(d){
  document.getElementById("tempNow").textContent =
    Math.round(d.main.temp)+"Â°";
  document.getElementById("weatherDesc").textContent =
    d.weather[0].description;
}

/* ===============================
   AQI
================================ */
async function loadAQI(lat,lon){
  try{
    const r = await fetch(
      `https://api.waqi.info/feed/geo:${lat};${lon}/?token=${WAQI_TOKEN}`
    );
    const d = await r.json();
    localStorage.setItem("aqi",JSON.stringify(d));
    document.getElementById("aqiVal").textContent = d.data.aqi;
  }catch{
    const cached = localStorage.getItem("aqi");
    if(cached){
      document.getElementById("aqiVal").textContent =
        JSON.parse(cached).data.aqi;
    }
  }
}

/* ===============================
   RAIN RADAR (IMAGE SAFE)
================================ */
function loadRadar(lat,lon){
  const ts = Math.floor(Date.now()/600000);
  document.getElementById("radarImg").src =
    `https://tilecache.rainviewer.com/v2/radar/${ts}/512/${8}/${Math.round(lon)}/${Math.round(lat)}/2/1_1.png`;
  document.getElementById("radarStatus").textContent = "";
}

/* ===============================
   MOCK DATA (SC + CAMERA)
================================ */
function loadStaticInfo(){
  document.getElementById("scName").textContent = "Central Rama 9";
  document.getElementById("scMeta").textContent = "2.4 km Â· 8 stalls";

  document.getElementById("camInfo").textContent =
    "Camera ahead in 1.2 km";
}

/* ===============================
   INIT
================================ */
(async ()=>{
  const loc = await getLocation();
  loadWeather(loc.lat,loc.lon);
  loadAQI(loc.lat,loc.lon);
  loadRadar(loc.lat,loc.lon);
  loadStaticInfo();
})();
</script>
</body>
</html>
